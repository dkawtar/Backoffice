{% extends "BackBundle::layout.html.twig" %}{#Include CSS#}  {% block stylesheets %}      {{ parent() }}      {% stylesheets      'https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css'      'bundles/back/css/tables.css'      'bundles/back/css/style.css'      filter='cssrewrite' %}      <link rel="stylesheet" href="{{ asset_url }}"/>      {% endstylesheets %}  {% endblock stylesheets %}{% block title %}    Dashboard |  {{ parent() }}{% endblock %} {% block header_breadcrumb %}     <li>         <span>Dashboard</span>     </li> {% endblock header_breadcrumb %}{% block action_toolbar %}{% endblock action_toolbar %}{% block back_body %}    <h3 class="page-title"> Dashboard        <small>dashboard & statistics</small>        {#{{ dump(users) }}#}    </h3>    <!-- BEGIN DASHBOARD STATS 1-->    <div class="row">        <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">            <a class="dashboard-stat dashboard-stat-v2 green" href="{{ path('back_user_list') }}">                <div class="visual">                    <i class="fa fa-user"></i>                </div>                <div class="details">                    <div class="number">                        {% if  users | length  > 0 %}                            <span data-counter="counterup" data-value="{{ (users | length )- 1 }}">0</span>                        {% else %}                            <span data-counter="counterup" data-value="0">0</span>                        {% endif %}                    </div>                    <div class="desc"> Comptes utilisateurs</div>                </div>            </a>        </div>        <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">            <a class="dashboard-stat dashboard-stat-v2 red-flamingo"               href="{{ path('back_user_filter', {'filter':'disabled'}) }}">                <div class="visual">                    <i class="fa fa-remove"></i>                </div>                <div class="details">                    {#<div class="number">                          <span data-counter="counterup"                                data-value="{{ ( usersLocked | length ) > 0 ? ( usersLocked | length )-1 :0 }}" >0</span>                    </div>                    <div class="desc"> Utilisateurs bloqués</div>#}                    <div class="number">                        <span data-counter="counterup"                              data-value="{{ ( usersDisabled | length ) > 0 ? ( usersDisabled | length )-1 :0 }}"                        >0</span>                    </div>                    <div class="desc"> Utilisateurs désactivés</div>                </div>            </a>        </div>        <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">            <a class="dashboard-stat dashboard-stat-v2 purple" href="{{ path('back_group_list') }}">                <div class="visual">                    <i class="fa fa-users"></i>                </div>                <div class="details">                    <div class="number">                        <span data-counter="counterup"                              data-value="{{ ( groups | length ) > 0 ? ( groups | length )-1 :0 }}">0</span>                    </div>                    <div class="desc"> Groupes</div>                </div>            </a>        </div>        <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">            <a class="dashboard-stat dashboard-stat-v2 yellow-casablanca" href="{{ path('back_computer_list') }}">                <div class="visual">                    <i class="fa fa-laptop"></i>                </div>                <div class="details">                    <div class="number">                        <span data-counter="counterup"                              data-value="{{ computers | length > 0 ? ( computers | length )-1 :0 }}">0</span>                    </div>                    <div class="desc"> Ordinateurs</div>                </div>            </a>        </div>    </div>    <div class="row" id="">        <div class="col-md-12 col-sm-12 margin-top-20">            <!-- BEGIN Portlet PORTLET-->            <div class="portlet">                <div class="portlet-title">                    <div class="caption font-green-sharp">                        <i class="icon-user font-green-sharp"></i>                        <span class="caption-subject bold uppercase"> Utilisateurs</span>                        {% if users is defined %}                            <span class="caption-helper">  Total: {{ ( users | length ) > 0 ? ( users | length )-1 :0 }}</span>                        {% endif %}                    </div>                    <div class="actions">                        <a href="{{ path('back_user_add') }}" title="Ajouter un customer"                           class="btn btn-sm btn-block green btn-outline"><span class="fa fa-plus"></span> Ajouter un                            utilisateur</a>                    </div>                </div>                <div class="portlet-body">                    {% include('BackBundle:Includes:alert.html.twig') %}                    <div class="row">                        <!-- BEGIN Row-->                        {% if users is defined %}                            <div class="col-sm-12">                                <table class="table table-condensed table-hover" id="table-users">                                    <thead>                                    <tr>                                        <th class="col-md-2">Login</th>                                        <th class="col-md-2">Nom/Prénom</th>                                        <th class="col-md-3">Email</th>                                        <th class="col-md-2">État</th>                                        <th class="col-md-3 text-center">Actions</th>                                    </tr>                                    </thead>                                    <tbody>                                    {% for key, user in users %}                                        {% set userprincipalname =ldap_service.getData(user,"userprincipalname") %}                                        {% if  ( userprincipalname is not null and  userprincipalname != ldap_user) %}                                            <tr id="line-{{ key }}">                                                {#<td class="col-md-2">{{ key }}</td>#}                                                <td class="col-md-2">{{ ldap_service.getData(user,"samaccountname") }}</td>                                                <td class="col-md-2">{{ ldap_service.getData(user,"displayname") }}</td>                                                <td class="col-md-3">{{ userprincipalname }}</td>                                                <td class="col-md-2">                                                    {% if  ldap_service.getData(user,"useraccountcontrol") == 512 %}                                                        <span class="label label-sm label-success">Normal </span>                                                    {% elseif  ldap_service.getData(user,"useraccountcontrol") == 2 %}                                                        <span class="label label-sm label-danger">Bloqué </span>                                                    {% elseif  ldap_service.getData(user,"useraccountcontrol") == 32 %}                                                        <span class="label label-sm label-warning">Pas PWD </span>                                                    {% elseif  ldap_service.getData(user,"useraccountcontrol") == 514 %}                                                        <span class="label label-sm label-danger">Désactivé </span>                                                    {% elseif  ldap_service.getData(user,"useraccountcontrol") == 544 %}                                                        <span class="label label-sm label-warning">Enabled, Password Not Required </span>                                                    {% elseif  ldap_service.getData(user,"useraccountcontrol") == 66048 %}                                                        <span class="label label-sm label-warning">Expiré </span>                                                    {% elseif  ldap_service.getData(user,"useraccountcontrol") == 64 %}                                                        <span class="label label-sm label-warning">Change PWD </span>                                                    {% else %}                                                        Autre: ({{ ldap_service.getData(user,"useraccountcontrol") }})                                                    {% endif %}                                                </td>                                                <td class="col-md-3 text-center">                                                    {% set login=ldap_service.getData(user,"userprincipalname") %}                                                    {% set dn=ldap_service.getData(user,"distinguishedname") %}                                                    {#{{ path('get_user',{'login':login }) }}#}                                                    <button type="button" data-toggle="modal"                                                            data-user="{{ ldap_service.base64Encode(dn) }}"                                                            class="btn btn-xs btn-outline btn-user-info green"><i                                                                class="fa fa-eye fa-fw"></i> Voir                                                    </button>                                                    <a href="{{ path('back_user_edit',{'login':ldap_service.getData(user,"samaccountname") }) }}"                                                       class="btn btn-xs btn-outline blue"><i                                                                class="fa fa-edit fa-fw"></i> Edit</a>                                                    {% if ldap_service.getData(user,"samaccountname") != "Administrator" %}                                                        <button type="button"                                                                class="btn btn-xs  btn-outline red btn-remove"                                                                data-action="remove-user"                                                                id="{{ ldap_service.getData(user,"cn") }}"                                                                data-tree="{{ dn }}"                                                                data-line="line-{{ key }}"><i                                                                    class="fa fa-trash-o fa-fw"></i>Supp                                                        </button>                                                    {% endif %}                                                </td>                                            </tr>                                        {% endif %}                                    {% endfor %}                                    </tbody>                                </table>                                <div class="text-center">                                    {#{{ knp_pagination_render(customers) }}#}                                </div>                            </div>                        {% endif %}                        {#{{ dump(customers) }}#}                        <!-- End Row-->                    </div>                </div>            </div>        </div>    </div>    <div class="row" id="">        <div class="col-md-12 col-sm-12 margin-top-20">            <!-- BEGIN Portlet PORTLET-->            <div class="portlet">                <div class="portlet-title">                    <div class="caption font-green-sharp">                        <i class="icon-user font-green-sharp"></i>                        <span class="caption-subject bold uppercase"> Groupes</span>                       {# {% if groups is defined %}                            <span class="caption-helper">  Total: {{ groups | length }}</span>                        {% endif %}#}                    </div>                    <div class="actions">                        <span class="font-black">  Type Groupe:</span>                        <span class="label label-sm label-danger"><i class="fa fa-lock"></i> Securité</span>                        <span class="label label-sm label-success"><i class="fa fa-cloud"></i>  Distribution</span>                    </div>                    {#  <div class="actions">                          <a href="{{ path('back_user_add') }}" title="Ajouter un customer"                             class="btn btn-sm btn-block green btn-outline"><span class="fa fa-plus"></span> Ajouter un                              utilisateur</a>                      </div>#}                </div>                <div class="portlet-body">                    <div class="row">                        <!-- BEGIN Row-->                        <div class="col-sm-12">                            {% if groups is defined %}                                {#{{ dump(groups) }}#}                                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">                                    {% for tab in groups %}                                        {% for  key, group in tab %}                                            {% if group|length >1 %}                                                {% set groupTitle =ldap_service.getData(group,"cn") %}                                                {% set arrayMembers =ldap_service.getArray(group,"member") %}                                                <div class="panel panel-default">                                                    <div class="panel-heading" role="tab" id="group-{{ key }}-{{ groupTitle}}">                                                        <a class="collapsed" role="button" data-toggle="collapse"                                                           data-parent="#accordion" href="#control-{{ key }}-{{ groupTitle}}"                                                           aria-expanded="false"                                                           aria-controls="control-{{ key }}-{{ groupTitle}}">                                                            <h6 class="panel-title">                                                                {% if ldap_service.getData(group,"grouptype") == 2 %}                                                                    <span class="label label-sm label-success"><i                                                                                class="fa fa-cloud fa-fw"></i></span>                                                                {% else %}                                                                    <span class="label label-sm label-danger"><i                                                                                class="fa fa-lock fa-fw"></i></span>                                                                {% endif %}                                                                {{ groupTitle | capitalize }}                                                                {#{{ ldap_service.getData(group,"grouptype") }}#}                                                                <span class="badge badge-info pull-right">                                                                {% if arrayMembers| length >0 %}{{ arrayMembers| length -1 }}{% else %}0{% endif %}                                                            </span>                                                            </h6>                                                        </a>                                                    </div>                                                    <div id="control-{{ key }}-{{ groupTitle}}" class="panel-collapse collapse"                                                         role="tabpanel"                                                         aria-labelledby="group-{{ key }}-{{ groupTitle}}">                                                        <div class="panel-body">                                                            <table class="table table-striped table-hover table-header-fixed table-groups"                                                                   cellspacing="0" width="100%"                                                                   data-line="10">                                                                <thead>                                                                <tr>                                                                    <th class="col-md-2">Login</th>                                                                    <th class="col-md-3">Nom</th>                                                                    <th class="col-md-4">Email</th>                                                                    <th class="col-md-1">Supprimer</th>                                                                </tr>                                                                </thead>                                                                <tbody>                                                                {#{{ dump(user) }}#}                                                                {% for  keyUser, userMemberDn in arrayMembers %}                                                                    {% if  keyUser != "count" or keyUser =="0" %}                                                                        {% set user =ldap_service.getUser(userMemberDn) %}                                                                        {% set userName = ldap_service.getOneData(user,"samaccountname") %}                                                                        <tr id="line-{{ groupTitle }}-{{ userName }}-{{ keyUser }}">                                                                            <td class="col-md-2">{{ userName }}</td>                                                                            <td class="col-md-3">{{ ldap_service.getOneData(user,"displayname") }}</td>                                                                            <td class="col-md-4">{{ ldap_service.getOneData(user,"userprincipalname") }}</td>                                                                            <td class="col-md-1 text-center">                                                                                <a href=""                                                                                   class="btn btn-xs red btn-outline btn-circle btn-remove"                                                                                   id="{{ userName }}"                                                                                   data-action="remove-group"                                                                                   data-groupName="{{ groupTitle }}"                                                                                   data-dnGroup="{{ ldap_service.getData(group,"distinguishedname") }}"                                                                                   data-dnUser="{{ userMemberDn }}"                                                                                   data-line="line-{{ groupTitle }}-{{ userName }}-{{ keyUser }}"><i                                                                                            class="fa fa-trash-o fa-fw"></i>                                                                                    Supp</a>                                                                            </td>                                                                        </tr>                                                                    {% endif %}                                                                {% endfor %}                                                                </tbody>                                                            </table>                                                        </div>                                                    </div>                                                </div>                                            {% endif %}                                        {% endfor %}                                    {% endfor %}                                </div>                                <!-- /.table-responsive -->                                <!-- /.panel-body -->                            {% endif %}                            {#{{ dump(customers) }}#}                        </div>                        <!-- End Row-->                    </div>                </div>            </div>        </div>    </div>{% endblock back_body %}{% block javascripts %}    {{ parent() }}    {% javascripts    "bundles/back/theme/assets/global/plugins/counterup/jquery.waypoints.min.js"    "bundles/back/theme/assets/global/plugins/counterup/jquery.counterup.min.js"    "bundles/back/theme/assets/global/plugins/datatables/datatables.min.js"    "bundles/back/js/ad/dataTable.js"    "bundles/back/js/ad/app.js" %}    <script src="{{ asset_url }}"></script>    {% endjavascripts %}{% endblock %}